<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Anvi Create</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{ --bg:#0f0f0f; --card:#1a1a1a; --accent:#e50914; }
body{margin:0;background:var(--bg);color:#fff;font-family:Arial,sans-serif}
header{background:#000;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
button{background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer}
.container{padding:20px; max-width: 1000px; margin: auto;}
.form-section{background:var(--card);padding:20px;border-radius:8px;margin-bottom:30px; border: 1px solid #333;}
input, select{width:100%;padding:10px;margin-bottom:12px;border:1px solid #333;border-radius:6px;background:#000;color:#fff;box-sizing:border-box}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:20px}
.card{background:var(--card);border-radius:8px;overflow:hidden;border:1px solid #222}
.card img{width:100%;height:220px;object-fit:cover}
.card-body{padding:10px}
.card-title{font-size:14px; font-weight:bold; margin-bottom:10px; height: 35px; overflow: hidden}
.actions{display:flex;gap:5px}
.edit{background:#ffa500; flex:1}
.delete{background:#ff4d4d; flex:1}
.tag{font-size:10px; padding:2px 5px; border-radius:4px; vertical-align: middle; margin-left: 5px}
.adult{background:red} .umum{background:gray}
</style>
</head>
<body>

<header>
  <h2>Anvi Admin</h2>
  <button style="background:#444" onclick="logout()">Logout</button>
</header>

<div class="container">
  <div class="form-section">
    <h3 id="formTitle">Tambah Konten Baru</h3>
    
    <label>Judul Film</label>
    <input id="m_title" placeholder="Contoh: Doctor Strange">
    
    <label>URL Thumbnail</label>
    <input id="m_thumb" placeholder="https://link-gambar.jpg">
    
    <label>URL Video (Google Drive/Embed)</label>
    <input id="m_video" placeholder="https://drive.google.com/file/d/...">
    
    <label>Rating Konten</label>
    <select id="m_is18">
      <option value="false">Umum (Biasa)</option>
      <option value="true">18+ (Dewasa)</option>
    </select>

    <button id="btnSave" onclick="saveMovie()" style="width:100%; font-weight:bold; margin-top:10px">SIMPAN KE DATABASE</button>
    <button id="btnCancel" onclick="resetForm()" style="width:100%; background:#444; margin-top:8px; display:none">BATAL EDIT</button>
  </div>

  <hr style="border:0; border-top:1px solid #333; margin:30px 0">
  
  <h3>Daftar Movies di Supabase</h3>
  <div class="grid" id="dataList"></div>
</div>

<script>
/* ================= CONFIG ================= */
const SUPABASE_URL = "https://xvktodveoxnuelhtzaog.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2a3RvZHZlb3hudWVsaHR6YW9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NzEzMjAsImV4cCI6MjA4NTM0NzMyMH0.WUvB6oKtKxxgO-5z0SH8uBUQx9c3Gn6r170qxGeKWTI";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let editId = null;

/* ================= FUNCTIONS ================= */

async function loadData() {
  const { data, error } = await sb.from("Movies").select("*").order("created_at", {ascending: false});
  if(error) return console.error(error);

  const listEl = document.getElementById("dataList");
  listEl.innerHTML = "";
  
  data.forEach(m => {
    listEl.innerHTML += `
      <div class="card">
        <img src="${m.thumb}">
        <div class="card-body">
          <div class="card-title">
            ${m.title} 
            <span class="tag ${m.is18 ? 'adult' : 'umum'}">${m.is18 ? '18+' : 'Umum'}</span>
          </div>
          <div class="actions">
            <button class="edit" onclick="prepareEdit(${m.id})">Edit</button>
            <button class="delete" onclick="deleteMovie(${m.id})">Hapus</button>
          </div>
        </div>
      </div>
    `;
  });
}

async function saveMovie() {
  const title = document.getElementById("m_title").value;
  const thumb = document.getElementById("m_thumb").value;
  const video = document.getElementById("m_video").value;
  const is18 = document.getElementById("m_is18").value === "true";

  if(!title || !thumb || !video) return alert("Mohon isi semua kolom!");

  const payload = { title, thumb, video, is18 };

  let res;
  if(editId) {
    res = await sb.from("Movies").update(payload).eq("id", editId);
  } else {
    res = await sb.from("Movies").insert([payload]);
  }

  if(res.error) {
    alert("Gagal: " + res.error.message);
  } else {
    alert("Data berhasil disimpan!");
    resetForm();
    loadData();
  }
}

async function deleteMovie(id) {
  if(!confirm("Hapus film ini dari database?")) return;
  const { error } = await sb.from("Movies").delete().eq("id", id);
  if(error) alert("Gagal menghapus");
  loadData();
}

async function prepareEdit(id) {
  const { data } = await sb.from("Movies").select("*").eq("id", id).single();
  document.getElementById("m_title").value = data.title;
  document.getElementById("m_thumb").value = data.thumb;
  document.getElementById("m_video").value = data.video;
  document.getElementById("m_is18").value = data.is18.toString();
  
  editId = id;
  document.getElementById("formTitle").innerText = "Edit Film: " + data.title;
  document.getElementById("btnSave").innerText = "UPDATE DATA";
  document.getElementById("btnCancel").style.display = "block";
  window.scrollTo({top: 0, behavior: 'smooth'});
}

function resetForm() {
  editId = null;
  document.getElementById("m_title").value = "";
  document.getElementById("m_thumb").value = "";
  document.getElementById("m_video").value = "";
  document.getElementById("m_is18").value = "false";
  document.getElementById("formTitle").innerText = "Tambah Konten Baru";
  document.getElementById("btnSave").innerText = "SIMPAN KE DATABASE";
  document.getElementById("btnCancel").style.display = "none";
}

function logout() {
  localStorage.removeItem("adminLogin");
  location.href = "login.html";
}

// Proteksi Halaman
if(localStorage.getItem("adminLogin") !== "true") location.href = "login.html";

loadData();
</script>
</body>
</html>
