<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Streaming</title>

<!-- SUPABASE CDN v2 -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b0b0b;
  --card:#151515;
  --accent:#e50914;
  --text:#ffffff;
  --muted:#9b9b9b;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:'Segoe UI',Arial,sans-serif;
}
header{
  position:sticky;
  top:0;
  z-index:10;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(10px);
  padding:14px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{margin:0;cursor:pointer}
nav a{
  color:var(--muted);
  margin-left:16px;
  text-decoration:none;
  font-size:14px;
}
nav a:hover{color:#fff}

.banner{
  height:340px;
  background-size:cover;
  background-position:center;
  position:relative;
}
.banner::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(to top,rgba(0,0,0,.9),rgba(0,0,0,.2));
}
.banner-content{
  position:absolute;
  bottom:40px;
  left:30px;
  z-index:2;
}
.banner-content h2{font-size:36px;margin:0 0 12px}
.banner-content button{
  background:var(--accent);
  border:none;
  color:#fff;
  padding:12px 22px;
  border-radius:30px;
  cursor:pointer;
}

.search{padding:20px}
.search input{
  width:100%;
  padding:12px 16px;
  background:#111;
  border:1px solid #222;
  border-radius:30px;
  color:#fff;
}

.section-title{
  padding:0 20px;
  margin-top:10px;
  font-size:18px;
}

.grid{
  padding:20px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:10px;
  overflow:hidden;
  cursor:pointer;
  transition:.25s;
}
.card:hover{transform:translateY(-6px) scale(1.03)}
.card img{width:100%;height:220px;object-fit:cover}
.card p{padding:10px;margin:0;font-size:14px}
</style>
</head>
<body>

<header>
  <h1 onclick="location.reload()">My Streaming</h1>
  <nav>
    <a href="#" onclick="openAdult()">18+</a>
    <a href="login.html" target="_blank">Admin</a>
  </nav>
</header>

<!-- ðŸ”¥ BANNER -->
<div class="banner" id="banner">
  <div class="banner-content">
    <h2 id="bannerTitle">Loading...</h2>
    <button onclick="openBanner()">â–¶ Play</button>
  </div>
</div>

<!-- ðŸ” SEARCH -->
<div class="search">
  <input id="search" placeholder="Search movie or series...">
</div>

<!-- ðŸŽ¬ MOVIES -->
<h2 class="section-title">ðŸŽ¬ Movies</h2>
<div class="grid" id="movieList"></div>

<!-- ðŸ“º SERIES -->
<h2 class="section-title">ðŸ“º Series</h2>
<div class="grid" id="seriesList"></div>

<script>
/* ================= SUPABASE ================= */
const SUPABASE_URL = "https://xvktodveoxnuelhtzaog.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2a3RvZHZlb3hudWVsaHR6YW9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NzEzMjAsImV4cCI6MjA4NTM0NzMyMH0.WUvB6oKtKxxgO-5z0SH8uBUQx9c3Gn6r170qxGeKWTI";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ================= STATE ================= */
let movies = [];
let series = [];
let bannerIndex = 0;

const movieList = document.getElementById("movieList");
const seriesList = document.getElementById("seriesList");
const search = document.getElementById("search");
const banner = document.getElementById("banner");
const bannerTitle = document.getElementById("bannerTitle");

/* ================= LOAD MOVIES ================= */
async function loadMovies(){
  const { data, error } = await sb
    .from("Movies")
    .select("*")
    .order("created_at",{ ascending:false });

  if(error){ console.error(error); return; }

  movies = data || [];
  renderMovies();
  renderBanner();
}

/* ================= LOAD SERIES ================= */
async function loadSeries(){
  const { data, error } = await sb
    .from("Series")
    .select("*")
    .order("created_at",{ ascending:false });

  if(error){ console.error(error); return; }

  series = data || [];
  renderSeries();
}

/* ================= RENDER MOVIES ================= */
function renderMovies(){
  movieList.innerHTML = "";
  const q = search.value.toLowerCase();

  movies.forEach(m=>{
    if(m.is18) return;
    if(!m.title.toLowerCase().includes(q)) return;

    movieList.innerHTML += `
      <div class="card" onclick="openMovie(${m.id})">
        <img src="${m.thumb}">
        <p>${m.title}</p>
      </div>
    `;
  });
}

/* ================= RENDER SERIES ================= */
function renderSeries(){
  seriesList.innerHTML = "";
  const q = search.value.toLowerCase();

  series.forEach(s=>{
    if(s.is18) return;
    if(!s.title.toLowerCase().includes(q)) return;

    seriesList.innerHTML += `
      <div class="card" onclick="openSeries(${s.id})">
        <img src="${s.thumb}">
        <p>${s.title}</p>
      </div>
    `;
  });
}

/* ================= BANNER ================= */
function renderBanner(){
  const bannerMovies = movies.filter(m=>!m.is18);
  if(bannerMovies.length === 0) return;

  const m = bannerMovies[bannerIndex];
  banner.style.backgroundImage = `url(${m.thumb})`;
  bannerTitle.innerText = m.title;
}

function openBanner(){
  const bannerMovies = movies.filter(m=>!m.is18);
  if(!bannerMovies[bannerIndex]) return;
  openMovie(bannerMovies[bannerIndex].id);
}

setInterval(()=>{
  const bannerMovies = movies.filter(m=>!m.is18);
  if(bannerMovies.length === 0) return;
  bannerIndex = (bannerIndex + 1) % bannerMovies.length;
  renderBanner();
},5000);

/* ================= OPEN ================= */
function openMovie(id){
  window.open("player.html?id="+id,"_blank");
}
function openSeries(id){
  window.open("series.html?id="+id,"_blank");
}

/* ================= SEARCH ================= */
search.addEventListener("input", ()=>{
  renderMovies();
  renderSeries();
});

/* ================= 18+ ================= */
const ADULT_CODE = "181818";
function openAdult(){
  if(sessionStorage.getItem("adultAccess")==="true"){
    location.href="adult.html"; return;
  }
  const code = prompt("Masukkan kode 18+");
  if(code===ADULT_CODE){
    sessionStorage.setItem("adultAccess","true");
    location.href="adult.html";
  }else alert("Kode salah");
}

/* ================= INIT ================= */
loadMovies();
loadSeries();
</script>

</body>
</html>

