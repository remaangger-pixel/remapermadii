<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Premium Player - Anvi Create</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root { --bg: #060606; --accent: #ff0513; --text: #ffffff; --muted: #888888; --card: #121212; }

body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow-x: hidden; }

/* HEADER */
header { 
  padding: 12px 5%; background: rgba(0,0,0,0.95); 
  display: flex; align-items: center; gap: 15px; 
  position: sticky; top: 0; z-index: 100; 
  border-bottom: 1px solid #111; backdrop-filter: blur(10px);
}

.back-btn { 
  background: var(--accent); border: none; color: #fff; padding: 8px 18px; 
  border-radius: 50px; cursor: pointer; font-weight: bold; 
  text-decoration: none; font-size: 13px; transition: 0.3s;
}
.back-btn:hover { filter: brightness(1.2); transform: scale(1.05); }

/* PLAYER SECTION */
.player-wrapper { 
  width: 100%; max-width: 1100px; margin: 0 auto; 
  box-sizing: border-box; 
}

.video-container { 
  position: relative; width: 100%; padding-top: 56.25%; /* 16:9 Ratio */
  background: #000; z-index: 1; 
}

.video-container iframe { 
  position: absolute; inset: 0; width: 100%; height: 100%; border: none; z-index: 5;
}

/* CONTENT INFO - Bagian yang kita rapikan agar tidak berantakan di HP */
.content-info {
  padding: 20px 5%;
  max-width: 1100px;
  margin: 0 auto;
}

.server-box { 
  display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 25px;
}

.btn-server { 
  flex: 1; min-width: 120px; background: var(--card); border: 1px solid #222; 
  color: #fff; padding: 12px 20px; border-radius: 8px; cursor: pointer; 
  font-size: 14px; font-weight: 600; transition: 0.3s; 
}
.btn-server.active { background: var(--accent); border-color: var(--accent); box-shadow: 0 4px 15px rgba(255, 5, 19, 0.3); }

.tag-container { margin-bottom: 15px; display: flex; gap: 8px; }
.tag { background: #1a1a1a; padding: 4px 12px; border-radius: 4px; font-size: 11px; color: var(--muted); font-weight: bold; text-transform: uppercase; }

.video-title { margin: 0 0 10px 0; font-size: clamp(20px, 4vw, 28px); font-weight: 800; line-height: 1.3; }
.video-desc { color: #666; font-size: 14px; margin: 0; line-height: 1.5; }

/* LOADER */
.loader { position: absolute; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 20; transition: 0.5s; pointer-events: none; }
.spinner { width: 40px; height: 40px; border: 4px solid #222; border-top-color: var(--accent); border-radius: 50%; animation: s 1s linear infinite; }
@keyframes s { to { transform: rotate(360deg); } }

/* RESPONSIVE PERBAIKAN */
@media (max-width: 768px) {
  .player-wrapper { margin-top: 0; }
  .video-container { border-radius: 0; }
  .btn-server { flex: 1; font-size: 13px; padding: 10px; }
  .content-info { padding: 15px 5%; }
}
</style>
</head>
<body>

<header id="mainHeader">
  <a href="index.html" class="back-btn">âœ• Close</a>
  <span id="navTitle" style="color:var(--muted); font-size:13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Loading...</span>
</header>

<div class="player-wrapper">
  <div class="video-container" id="playerParent">
    <div id="loader" class="loader"><div class="spinner"></div></div>
    <div id="playerFrame"></div>
  </div>
</div>

<div class="content-info">
  <div class="server-box" id="serverList">
    </div>

  <div class="tag-container">
    <span class="tag" id="vType">Video</span>
    <span class="tag">Ultra HD</span>
  </div>

  <h1 id="vTitle" class="video-title">...</h1>
  <p id="vDesc" class="video-desc">Ganti server jika video lambat atau tidak muncul.</p>
</div>

<script>
const SUPABASE_URL = "https://xvktodveoxnuelhtzaog.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2a3RvZHZlb3hudWVsaHR6YW9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NzEzMjAsImV4cCI6MjA4NTM0NzMyMH0.WUvB6oKtKxxgO-5z0SH8uBUQx9c3Gn6r170qxGeKWTI";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const params = new URLSearchParams(location.search);
const movieId = params.get("id");
const epsId = params.get("eps");

async function init() {
  let videoData = null;
  if (movieId) {
    const { data } = await sb.from("Movies").select("*").eq("id", movieId).maybeSingle();
    videoData = data;
    if(data) renderUI(data.title, "Movie");
  } else if (epsId) {
    const { data } = await sb.from("Episodes").select("*, Series(title)").eq("id", epsId).maybeSingle();
    videoData = data;
    if(data) renderUI(`${data.Series.title} - Eps ${data.episode}`, "Series");
  }

  if (videoData) {
    setupServers(videoData.video, videoData.video2);
  } else {
    location.href = "index.html";
  }
}

function renderUI(title, type) {
  document.getElementById("navTitle").innerText = "Watching: " + title;
  document.getElementById("vTitle").innerText = title;
  document.getElementById("vType").innerText = type;
}

function setupServers(s1, s2) {
  const serverBox = document.getElementById("serverList");
  serverBox.innerHTML = "";
  const servers = [];
  if (s1 && s1.trim()) servers.push({ name: "Server 1", url: s1.trim() });
  if (s2 && s2.trim()) servers.push({ name: "Server 2", url: s2.trim() });

  servers.forEach((srv, index) => {
    const btn = document.createElement("button");
    btn.className = "btn-server" + (index === 0 ? " active" : "");
    btn.innerText = srv.name;
    btn.onclick = () => {
      loadVideo(srv.url);
      document.querySelectorAll('.btn-server').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    };
    serverBox.appendChild(btn);
  });
  if (servers.length > 0) loadVideo(servers[0].url);
}

function loadVideo(url) {
  const frame = document.getElementById("playerFrame");
  const loader = document.getElementById("loader");
  const cleanUrl = url.replace(/,$/, "").trim();
  
  loader.style.opacity = "1";
  
  frame.innerHTML = `
    <iframe 
      src="${cleanUrl}" 
      allowfullscreen 
      webkitallowfullscreen 
      mozallowfullscreen 
      allow="autoplay; fullscreen; encrypted-media; picture-in-picture"
      referrerpolicy="no-referrer">
    </iframe>`;
  
  setTimeout(() => { loader.style.opacity = "0"; }, 1500);
}

init();
</script>
</body>
</html>
