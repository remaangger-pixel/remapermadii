<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Playing - Anvi Create</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg: #060606;
  --card: #121212;
  --accent: #ff0513;
  --text: #ffffff;
  --muted: #888888;
}

body {
  margin: 0; background: var(--bg); color: var(--text);
  font-family: 'Inter', sans-serif; overflow-x: hidden;
}

/* HEADER */
header {
  padding: 12px 5%; background: rgba(0,0,0,0.9);
  display: flex; align-items: center; gap: 15px;
  position: sticky; top: 0; z-index: 100;
  border-bottom: 1px solid #111;
}

.back-btn {
  background: var(--accent); border: none; color: #fff;
  padding: 8px 18px; border-radius: 50px; cursor: pointer;
  font-weight: bold; transition: 0.3s; text-decoration: none; font-size: 13px;
}
.back-btn:hover { transform: scale(1.05); filter: brightness(1.2); }

/* PLAYER */
.player-wrapper {
  width: 100%; max-width: 1100px; margin: 20px auto; padding: 0 15px;
}
.video-container {
  position: relative; width: 100%; padding-top: 56.25%;
  background: #000; border-radius: 12px; overflow: hidden;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}
.video-container iframe {
  position: absolute; inset: 0; width: 100%; height: 100%; border: none;
}

/* INFO */
.video-info { padding: 0 5%; margin-bottom: 40px; }
.video-info h1 { font-size: clamp(20px, 4vw, 28px); margin: 20px 0 10px; }
.meta { display: flex; gap: 10px; margin-bottom: 15px; }
.tag { background: #1a1a1a; padding: 4px 10px; border-radius: 4px; font-size: 11px; color: var(--muted); }

/* RECOMMENDATION */
.rec-section { padding: 0 5% 50px; }
.rec-title { font-size: 18px; margin-bottom: 20px; border-left: 3px solid var(--accent); padding-left: 10px; }
.grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 20px;
}
.card { background: var(--card); border-radius: 8px; overflow: hidden; cursor: pointer; transition: 0.3s; }
.card:hover { transform: translateY(-5px); }
.card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
.card-t { padding: 8px; font-size: 12px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* LOADER */
.loader { position: absolute; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 10; transition: 0.5s; }
.spinner { width: 40px; height: 40px; border: 4px solid #222; border-top-color: var(--accent); border-radius: 50%; animation: s 1s linear infinite; }
@keyframes s { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<header>
  <a href="index.html" class="back-btn">âœ• Close Player</a>
  <span id="navTitle" style="color:var(--muted); font-size:13px; font-weight:500;">Loading...</span>
</header>

<div class="player-wrapper">
  <div class="video-container">
    <div id="loader" class="loader"><div class="spinner"></div></div>
    <div id="playerFrame"></div>
  </div>
</div>

<div class="video-info">
  <div class="meta">
    <span class="tag" id="vType">Video</span>
    <span class="tag">Ultra HD</span>
    <span class="tag">2026</span>
  </div>
  <h1 id="vTitle">...</h1>
  <p id="vDesc" style="color:#aaa; font-size:14px; line-height:1.6;">Selamat menonton! Gunakan koneksi stabil untuk pengalaman terbaik.</p>
</div>

<div class="rec-section">
  <h3 class="rec-title">Mungkin Kamu Suka</h3>
  <div class="grid" id="recList"></div>
</div>

<script>
const SUPABASE_URL = "https://xvktodveoxnuelhtzaog.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2a3RvZHZlb3hudWVsaHR6YW9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NzEzMjAsImV4cCI6MjA4NTM0NzMyMH0.WUvB6oKtKxxgO-5z0SH8uBUQx9c3Gn6r170qxGeKWTI";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const params = new URLSearchParams(location.search);
const id = params.get("id");

async function init() {
  if (!id) return location.href = "index.html";

  // Load Main Video
  const { data, error } = await sb.from("Movies").select("*").eq("id", id).single();
  
  if (data) {
    document.title = data.title + " - Playing";
    document.getElementById("navTitle").innerText = "Watching: " + data.title;
    document.getElementById("vTitle").innerText = data.title;
    document.getElementById("playerFrame").innerHTML = `<iframe src="${data.video}" allowfullscreen allow="autoplay"></iframe>`;
    
    setTimeout(() => {
      document.getElementById("loader").style.opacity = "0";
      setTimeout(() => document.getElementById("loader").remove(), 500);
    }, 1000);
  }

  // Load Recommendations (Ambil 6 film acak selain yang sedang diputar)
  const { data: recs } = await sb.from("Movies").select("*").neq("id", id).limit(6);
  const recList = document.getElementById("recList");
  
  recs.forEach(r => {
    if(r.is18) return;
    recList.innerHTML += `
      <div class="card" onclick="location.href='player.html?id=${r.id}'">
        <img src="${r.thumb}">
        <div class="card-t">${r.title}</div>
      </div>
    `;
  });
}

init();
</script>

</body>
</html>
