<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Series Detail - Anvi Create</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --bg: #060606;
  --card: #121212;
  --accent: #ff0513;
  --text: #ffffff;
  --muted: #a0a0a0;
}

body {
  margin: 0; background: var(--bg); color: var(--text);
  font-family: 'Inter', sans-serif; opacity: 0; transition: 0.5s;
}

/* BANNER SERIES */
.series-banner {
  height: 50vh; width: 100%; position: relative;
  background-size: cover; background-position: center;
  display: flex; align-items: flex-end; padding: 0 5% 40px;
}
.series-banner::after {
  content: ""; position: absolute; inset: 0;
  background: linear-gradient(to top, var(--bg) 10%, transparent 90%);
}

.banner-content { position: relative; z-index: 2; }
.banner-content h1 { font-size: clamp(24px, 5vw, 42px); margin: 0; font-weight: 800; }

/* NAV BACK */
.nav-top {
  position: fixed; top: 0; width: 100%; padding: 15px 5%;
  z-index: 100; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
}
.back-btn {
  background: var(--accent); color: #fff; padding: 8px 20px;
  border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 13px;
}

/* EPISODE LIST */
.container { padding: 40px 5%; }
.section-title { 
  font-size: 20px; margin-bottom: 25px; border-left: 4px solid var(--accent); 
  padding-left: 15px; font-weight: 700;
}

.ep-grid {
  display: grid; grid-template-columns: 1fr; gap: 15px;
}

.ep-item {
  background: var(--card); border-radius: 12px; display: flex;
  align-items: center; padding: 12px; cursor: pointer;
  transition: 0.3s; border: 1px solid #1a1a1a;
}
.ep-item:hover { transform: scale(1.02); border-color: var(--accent); background: #1a1a1a; }

.ep-num {
  font-size: 24px; font-weight: 900; color: var(--accent);
  width: 50px; text-align: center; margin-right: 15px; opacity: 0.5;
}

.ep-info { flex: 1; }
.ep-info div { font-weight: bold; font-size: 15px; margin-bottom: 4px; }
.ep-info span { font-size: 12px; color: var(--muted); }

.play-icon {
  width: 35px; height: 35px; background: var(--accent);
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 14px; margin-left: 10px;
}

@media(min-width: 768px) {
  .ep-grid { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body>

<div class="nav-top">
  <a href="index.html" class="back-btn">← Kembali</a>
</div>

<div class="series-banner" id="banner">
  <div class="banner-content">
    <h1 id="sTitle">Loading Series...</h1>
    <p id="sTag" style="color:var(--accent); font-weight:bold; margin-top:10px;">TV SERIES</p>
  </div>
</div>

<div class="container">
  <h2 class="section-title">Daftar Episode</h2>
  <div class="ep-grid" id="epList">
    </div>
</div>

<script>
const SUPABASE_URL = "https://xvktodveoxnuelhtzaog.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2a3RvZHZlb3hudWVsaHR6YW9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NzEzMjAsImV4cCI6MjA4NTM0NzMyMH0.WUvB6oKtKxxgO-5z0SH8uBUQx9c3Gn6r170qxGeKWTI";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const params = new URLSearchParams(location.search);
const seriesId = params.get("id");

async function init() {
  if (!seriesId) return location.href = "index.html";

  // 1. Ambil Data Series
  const { data: series } = await sb.from("Series").select("*").eq("id", seriesId).single();
  
  if (series) {
    document.title = series.title + " - Anvi Create";
    document.getElementById("sTitle").innerText = series.title;
    document.getElementById("banner").style.backgroundImage = `url(${series.thumb})`;
    document.body.style.opacity = "1";
  }

  // 2. Ambil Daftar Episode
  const { data: episodes } = await sb.from("Episodes")
    .select("*")
    .eq("series_id", seriesId)
    .order("episode", { ascending: true });

  const listEl = document.getElementById("epList");
  listEl.innerHTML = "";

  if (episodes && episodes.length > 0) {
    episodes.forEach(ep => {
      listEl.innerHTML += `
        <div class="ep-item" onclick="playEpisode('${ep.id}')">
          <div class="ep-num">${ep.episode}</div>
          <div class="ep-info">
            <div>Episode ${ep.episode}</div>
            <span>${ep.title || 'Tonton sekarang di Anvi Create'}</span>
          </div>
          <div class="play-icon">▶</div>
        </div>
      `;
    });
  } else {
    listEl.innerHTML = "<p style='color:var(--muted)'>Belum ada episode yang tersedia.</p>";
  }
}

function playEpisode(id) {
  document.body.style.opacity = "0";
  setTimeout(() => {
    // Pastikan player.html sudah mendukung parameter ?eps=
    location.href = "player.html?eps=" + id;
  }, 400);
}

init();
</script>
</body>
</html>
