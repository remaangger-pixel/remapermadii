<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Series</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
}
header{
  padding:12px 16px;
  background:#111;
  display:flex;
  align-items:center;
  gap:12px;
}
header button{
  background:#e50914;
  border:none;
  color:#fff;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
.banner{
  height:280px;
  background-size:cover;
  background-position:center;
  position:relative;
}
.banner::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(to top,rgba(0,0,0,.9),rgba(0,0,0,.3));
}
.banner-content{
  position:absolute;
  bottom:20px;
  left:20px;
  z-index:2;
}
.banner-content h1{margin:0}
.banner-content p{
  margin-top:6px;
  font-size:14px;
  color:#ccc;
}

.player{
  position:relative;
  width:100%;
  padding-top:56.25%;
  background:#000;
}
.player iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
}

.episodes{
  padding:16px;
}
.episode{
  padding:12px;
  background:#151515;
  border-radius:8px;
  margin-bottom:10px;
  cursor:pointer;
}
.episode:hover{background:#222}
</style>
</head>
<body>

<header>
  <button onclick="history.back()">‚Üê Back</button>
  <span id="headerTitle">Loading...</span>
</header>

<div id="banner" class="banner"></div>

<div id="player"></div>

<div class="episodes" id="episodes"></div>

<script>
/* ================= SUPABASE ================= */
const SUPABASE_URL = "https://xvktodveoxnuelhtzaog.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2a3RvZHZlb3hudWVsaHR6YW9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NzEzMjAsImV4cCI6MjA4NTM0NzMyMH0.WUvB6oKtKxxgO-5z0SH8uBUQx9c3Gn6r170qxGeKWTI";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ================= PARAM ================= */
const params = new URLSearchParams(location.search);
const seriesId = params.get("id");

if(!seriesId){
  alert("Series tidak ditemukan");
}

/* ================= LOAD SERIES ================= */
async function loadSeries(){
  const { data, error } = await sb
    .from("Series")
    .select("*")
    .eq("id", seriesId)
    .single();

  if(error || !data){
    alert("Series tidak ditemukan");
    return;
  }

  // üîû CEK 18+
  if(data.is18 && sessionStorage.getItem("adultAccess") !== "true"){
    alert("Konten 18+ terkunci");
    location.href = "index.html";
    return;
  }

  document.title = data.title;
  document.getElementById("headerTitle").innerText = data.title;

  document.getElementById("banner").style.backgroundImage =
    `url(${data.thumb})`;

  document.getElementById("banner").innerHTML = `
    <div class="banner-content">
      <h1>${data.title}</h1>
      <p>${data.description || ""}</p>
    </div>
  `;
}

/* ================= LOAD EPISODES ================= */
async function loadEpisodes(){
  const { data, error } = await sb
    .from("Episodes")
    .select("*")
    .eq("series_id", seriesId)
    .order("episode",{ ascending:true });

  if(error){
    console.error(error);
    return;
  }

  if(data.length === 0){
    document.getElementById("episodes").innerHTML =
      "<p>Episode belum tersedia</p>";
    return;
  }

  data.forEach(e=>{
    document.getElementById("episodes").innerHTML += `
      <div class="episode" onclick="playEpisode('${e.video}')">
        Episode ${e.episode} ‚Äì ${e.title}
      </div>
    `;
  });

  // autoplay episode 1
  playEpisode(data[0].video);
}

/* ================= PLAYER ================= */
function playEpisode(video){
  document.getElementById("player").innerHTML = `
    <div class="player">
      <iframe 
        src="${video}" 
        allow="autoplay; fullscreen"
        allowfullscreen>
      </iframe>
    </div>
  `;
}

/* ================= INIT ================= */
loadSeries();
loadEpisodes();
</script>

</body>
</html>
